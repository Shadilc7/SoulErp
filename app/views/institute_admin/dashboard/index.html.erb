<!-- Institute Admin Dashboard -->
<div class="container-fluid py-4">
  <!-- KPI Cards Row 1 -->
  <div class="row g-4 mb-4">
    <!-- Total Participants -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted mb-0">Total Participants</h6>
              <h2 class="mt-2 mb-0"><%= @total_participants %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i> 
                <small><%= @active_participants %> Active</small>
              </p>
            </div>
            <div class="icon-box bg-primary bg-opacity-10">
              <i class="bi bi-people fs-1 text-primary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Questions -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted mb-0">Total Questions</h6>
              <h2 class="mt-2 mb-0"><%= @total_questions %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small>+12% from last month</small>
              </p>
            </div>
            <div class="icon-box bg-success bg-opacity-10">
              <i class="bi bi-question-circle fs-1 text-success"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Question Sets -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted mb-0">Question Sets</h6>
              <h2 class="mt-2 mb-0"><%= @total_question_sets %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small>+8% from last month</small>
              </p>
            </div>
            <div class="icon-box bg-info bg-opacity-10">
              <i class="bi bi-collection fs-1 text-info"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Assignments -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
              <h6 class="card-title text-muted mb-0">Total Assignments</h6>
              <h2 class="mt-2 mb-0"><%= @total_assignments %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small>+15% from last month</small>
              </p>
            </div>
            <div class="icon-box bg-warning bg-opacity-10">
              <i class="bi bi-clipboard-check fs-1 text-warning"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KPI Cards Row 2 -->
  <div class="row g-4 mb-4">
    <!-- Total Sections -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted mb-0">Total Sections</h6>
              <h2 class="mt-2 mb-0"><%= @total_sections %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small><%= @active_sections %> Active</small>
              </p>
            </div>
            <div class="icon-box bg-danger bg-opacity-10">
              <i class="bi bi-grid fs-1 text-danger"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Trainers -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
              <h6 class="card-title text-muted mb-0">Total Trainers</h6>
              <h2 class="mt-2 mb-0"><%= @total_trainers %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small><%= @active_trainers %> Active</small>
              </p>
            </div>
            <div class="icon-box bg-primary bg-opacity-10">
              <i class="bi bi-person-workspace fs-1 text-primary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Training Programs -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="card-title text-muted mb-0">Training Programs</h6>
              <h2 class="mt-2 mb-0"><%= @total_training_programs %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small><%= @active_programs_count %> Active</small>
              </p>
            </div>
            <div class="icon-box bg-success bg-opacity-10">
              <i class="bi bi-mortarboard fs-1 text-success"></i>
            </div>
          </div>
      </div>
    </div>
  </div>

    <!-- Feedback Received -->
    <div class="col-xl-3 col-md-6">
      <div class="card card-custom h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
              <h6 class="card-title text-muted mb-0">Feedback Received</h6>
              <h2 class="mt-2 mb-0"><%= @total_feedback_received || 0 %></h2>
              <p class="text-success mb-0">
                <i class="bi bi-arrow-up"></i>
                <small>+5% from last month</small>
              </p>
            </div>
            <div class="icon-box bg-info bg-opacity-10">
              <i class="bi bi-chat-square-text fs-1 text-info"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row g-4 mb-4">
    <!-- Participants by Section -->
    <div class="col-xl-6">
      <div class="card card-custom h-100">
        <div class="card-header border-0 pt-3">
          <h5 class="card-title mb-0">Participants by Section</h5>
        </div>
        <div class="card-body">
          <!-- Participants by Section Chart Container -->
          <div id="participants-section-chart"></div>
        </div>
      </div>
    </div>

    <!-- Participants by Type -->
    <div class="col-xl-6">
      <div class="card card-custom h-100">
        <div class="card-header border-0 pt-3">
          <h5 class="card-title mb-0">Participants by Type</h5>
        </div>
        <div class="card-body">
          <!-- Participants by Type Chart Container -->
          <div id="participants-type-chart"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Feedback Progress Row -->
  <div class="row g-4 mb-4">
    <div class="col-12">
    <div class="card card-custom">
        <div class="card-header border-0 pt-3">
          <h5 class="card-title mb-0">Feedback Overview</h5>
        </div>
      <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-4">
              <h6 class="text-muted mb-3">Feedback Received</h6>
              <div class="progress" style="height: 25px;">
                <div class="progress-bar bg-success" role="progressbar" 
                     style="width: <%= @feedback_received_percentage || 0 %>%;" 
                     aria-valuenow="<%= @feedback_received_percentage || 0 %>" 
                     aria-valuemin="0" aria-valuemax="100">
                  <%= @feedback_received_percentage || 0 %>%
                </div>
              </div>
              <div class="d-flex justify-content-between mt-2">
                <small class="text-muted">Total: <%= @total_feedback_received || 0 %></small>
                <small class="text-muted">Target: 100%</small>
              </div>
            </div>
            <div class="col-md-6 mb-4">
              <h6 class="text-muted mb-3">Feedback Pending</h6>
              <div class="progress" style="height: 25px;">
                <div class="progress-bar bg-warning" role="progressbar" 
                     style="width: <%= @feedback_pending_percentage || 0 %>%;" 
                     aria-valuenow="<%= @feedback_pending_percentage || 0 %>" 
                     aria-valuemin="0" aria-valuemax="100">
                  <%= @feedback_pending_percentage || 0 %>%
                </div>
              </div>
              <div class="d-flex justify-content-between mt-2">
                <small class="text-muted">Total: <%= @total_feedback_pending || 0 %></small>
                <small class="text-muted">Target: 0%</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Feedback Trend Chart -->
  <div class="row g-4 mb-4">
    <div class="col-12">
      <div class="card card-custom">
        <div class="card-header border-0 pt-3">
          <h5 class="card-title mb-0">Feedback by Training Program</h5>
        </div>
        <div class="card-body">
          <!-- Feedback by Training Program Chart Container -->
          <div id="feedback-training-chart"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Training Programs Table -->
  <div class="card card-custom">
    <div class="card-header border-0 pt-3">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">Recent Training Programs</h5>
        <%= link_to "View All", institute_admin_training_programs_path, class: "btn btn-sm btn-primary" %>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <% if @recent_programs.present? %>
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Program</th>
                <th>Participants</th>
                <th>Feedback Rate</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% @recent_programs.each do |program| %>
                <tr>
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="program-icon me-2">
                        <i class="bi bi-book text-primary"></i>
                      </div>
                      <div>
                        <%= program.title %>
                        <br>
                        <small class="text-muted"><%= program.start_date&.strftime("%b %d, %Y") %></small>
                      </div>
                    </div>
                  </td>
                  <td><%= program.participants_count %></td>
                  <td>
                    <div class="progress" style="height: 6px; width: 120px;">
                      <div class="progress-bar bg-success" role="progressbar" 
                           style="width: <%= program.feedback_percentage %>%" 
                           aria-valuenow="<%= program.feedback_percentage %>" 
                           aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <small class="text-muted"><%= program.feedback_percentage %>%</small>
                  </td>
                  <td>
                    <span class="badge bg-<%= program.status == 'ongoing' ? 'success' : 'secondary' %>">
                      <%= program.status %>
                    </span>
                  </td>
                  <td>
                    <%= link_to institute_admin_training_program_path(program), class: "btn btn-sm btn-light" do %>
                      <i class="bi bi-eye"></i>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% else %>
          <div class="alert alert-info">No recent training programs found</div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Participants by Section Chart
    var sectionChartOptions = {
      chart: { type: 'bar', height: 300 },
      series: [{
        name: 'Participants',
        data: <%= @section_data[:participants] %>
      }, {
        name: 'Capacity',
        data: <%= @section_data[:capacity] %>
      }],
      xaxis: { categories: <%= raw @section_labels.to_json %> },
      colors: ['#6366f1', '#c7d2fe']
    };
    new ApexCharts(document.querySelector("#participants-section-chart"), sectionChartOptions).render();

    // Participants by Type Pie Chart
    var optionsType = {
      chart: { type: 'pie', height: 300 },
      series: <%= @type_data %>,
      labels: <%= raw @type_labels.to_json %>
    };
    var chartType = new ApexCharts(document.querySelector("#participants-type-chart"), optionsType);
    chartType.render();

    // Feedback by Training Program Chart
    var feedbackChartOptions = {
      chart: { type: 'bar', height: 300 },
      series: [{
        name: 'Received',
        data: <%= @program_feedback_data.map { |d| d[:received].to_i } %>
      }, {
        name: 'Pending',
        data: <%= @program_feedback_data.map { |d| d[:pending].to_i } %>
      }],
      xaxis: { categories: <%= raw @program_feedback_data.map { |d| d[:name] }.to_json %> },
      colors: ['#22c55e', '#f59e0b']
    };
    new ApexCharts(document.querySelector("#feedback-training-chart"), feedbackChartOptions).render();
  });
</script>
