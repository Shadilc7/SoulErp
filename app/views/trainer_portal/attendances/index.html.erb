<div class="card card-custom">
  <div class="card-header card-header-custom">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-0">Attendance Records</h5>
        <p class="text-muted mb-0"><%= @training_program.title %></p>
      </div>
      <%= link_to new_trainer_portal_training_program_attendance_path(@training_program), 
          class: "btn btn-primary" do %>
        <i class="bi bi-plus-lg"></i> Mark Attendance
      <% end %>
    </div>
  </div>

  <div class="card-body">
    <% if @attendances.any? %>
      <div class="accordion" id="attendanceAccordion">
        <% @attendances.each do |date, records| %>
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" 
                      data-bs-toggle="collapse" 
                      data-bs-target="#collapse<%= date.to_fs(:number) %>">
                <div class="d-flex justify-content-between align-items-center w-100">
                  <strong><%= date.strftime("%B %d, %Y") %></strong>
                  <div class="ms-3">
                    <span class="badge bg-success">
                      <%= records.count(&:present?) %> Present
                    </span>
                    <span class="badge bg-warning ms-1">
                      <%= records.count(&:late?) %> Late
                    </span>
                    <span class="badge bg-danger ms-1">
                      <%= records.count(&:absent?) %> Absent
                    </span>
                  </div>
                </div>
              </button>
            </h2>
            <div id="collapse<%= date.to_fs(:number) %>" class="accordion-collapse collapse" 
                 data-bs-parent="#attendanceAccordion">
              <div class="accordion-body">
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Participant</th>
                        <th>Status</th>
                        <th>Marked By</th>
                        <th>Remarks</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% records.each do |attendance| %>
                        <tr>
                          <td><%= attendance.participant.user.full_name %></td>
                          <td>
                            <span class="badge <%= attendance.present? ? 'bg-success' : 
                                                   attendance.late? ? 'bg-warning' :
                                                   attendance.excused? ? 'bg-info' : 'bg-danger' %>">
                              <%= attendance.status.titleize %>
                            </span>
                          </td>
                          <td><%= attendance.marked_by.full_name %></td>
                          <td><%= attendance.remarks %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-4">
        <i class="bi bi-calendar-x fs-1 text-muted mb-3"></i>
        <p class="text-muted mb-0">No attendance records found</p>
      </div>
    <% end %>
  </div>
</div>

<% content_for :styles do %>
  <style>
    .accordion-button:not(.collapsed) {
      background-color: #f8f9fa;
      color: var(--text-primary);
    }

    .accordion-button:focus {
      box-shadow: none;
      border-color: rgba(0,0,0,.125);
    }

    .badge {
      font-weight: 500;
    }
  </style>
<% end %> 